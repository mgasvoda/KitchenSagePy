<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KitchenSage - Recipe Management</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <header class="main-header">
            <div class="logo">
                <a href="/">
                    <h1>KitchenSage</h1>
                </a>
            </div>
            <div class="search-container">
                <form action="/search" method="get" class="search-form">
                    <input type="text" name="query" placeholder="Search recipes..." value="{{ query or '' }}" class="search-input">
                    <button type="submit" class="search-button">Search</button>
                </form>
            </div>
        </header>

        <div class="content">
            <aside class="sidebar">
                <div class="categories-container">
                    <h2>Categories</h2>
                    <ul class="categories-list">
                        <li class="category-item">
                            <a href="/" class="category-link {% if not selected_category %}active{% endif %}">All Recipes</a>
                        </li>
                        {% for category in categories %}
                            <li class="category-item">
                                <a href="/search?category={{ category.name }}" class="category-link {% if selected_category == category.name %}active{% endif %}">
                                    {{ category.name }}
                                </a>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            </aside>

            <main class="main-content">
                <div class="recipes-header">
                    <h2>
                        {% if query %}
                            Search Results for "{{ query }}"
                        {% elif selected_category %}
                            {{ selected_category }} Recipes
                        {% else %}
                            All Recipes
                        {% endif %}
                    </h2>
                    <p class="recipe-count">{{ total }} recipe{% if total != 1 %}s{% endif %} found</p>
                </div>

                {% if recipes %}
                    <div class="recipes-grid">
                        {% for recipe in recipes %}
                            <div class="recipe-card">
                                <a href="/recipe/{{ recipe.id }}" class="recipe-link">
                                    <h3 class="recipe-title">{{ recipe.name }}</h3>
                                    {% if recipe.rating > 0 %}
                                        <div class="recipe-rating">
                                            {% for i in range(recipe.rating) %}
                                                <span class="star">★</span>
                                            {% endfor %}
                                            {% for i in range(5 - recipe.rating) %}
                                                <span class="star empty">☆</span>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                    {% if recipe.categories %}
                                        <div class="recipe-categories">
                                            {% for category in recipe.categories %}
                                                <span class="category-tag">{{ category.name }}</span>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                    
                                    {% if recipe.prep_time or recipe.cook_time %}
                                        <div class="recipe-card-times">
                                            {% if recipe.prep_time %}
                                                <span class="recipe-card-prep-time">Prep: {{ recipe.prep_time }}</span>
                                            {% endif %}
                                            {% if recipe.cook_time %}
                                                <span class="recipe-card-cook-time">Cook: {{ recipe.cook_time }}</span>
                                            {% endif %}
                                        </div>
                                    {% endif %}
                                </a>
                            </div>
                        {% endfor %}
                    </div>

                    {% if total_pages > 1 %}
                        <div class="pagination">
                            {% if current_page > 1 %}
                                <a href="/search?{% if query %}query={{ query }}{% endif %}{% if selected_category %}&category={{ selected_category }}{% endif %}&skip={{ (current_page-2)*limit }}&limit={{ limit }}" class="page-link">&laquo; Prev</a>
                            {% endif %}
                            
                            {% for page_num in range(1, total_pages + 1) %}
                                {% if page_num == current_page %}
                                    <span class="page-link current">{{ page_num }}</span>
                                {% elif page_num == 1 or page_num == total_pages or (page_num >= current_page - 2 and page_num <= current_page + 2) %}
                                    <a href="/search?{% if query %}query={{ query }}{% endif %}{% if selected_category %}&category={{ selected_category }}{% endif %}&skip={{ (page_num-1)*limit }}&limit={{ limit }}" class="page-link">{{ page_num }}</a>
                                {% elif page_num == current_page - 3 or page_num == current_page + 3 %}
                                    <span class="page-ellipsis">...</span>
                                {% endif %}
                            {% endfor %}
                            
                            {% if current_page < total_pages %}
                                <a href="/search?{% if query %}query={{ query }}{% endif %}{% if selected_category %}&category={{ selected_category }}{% endif %}&skip={{ current_page*limit }}&limit={{ limit }}" class="page-link">Next &raquo;</a>
                            {% endif %}
                        </div>
                    {% endif %}
                {% else %}
                    <div class="no-recipes">
                        <p>No recipes found. Try a different search or category.</p>
                    </div>
                {% endif %}
            </main>
        </div>

        <footer class="main-footer">
            <p>&copy; {{ current_year }} KitchenSage. All rights reserved.</p>
        </footer>
    </div>
</body>
</html>